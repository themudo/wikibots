This is code I have used over the years on Wikimedia projects, particularly Portuguese Wikipedia. No guarantee that it works!
